<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.59.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>点击子元素跳转回退不丢失数据 &middot; 学习笔记</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://lijianqiang1997.github.io/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://lijianqiang1997.github.io/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://lijianqiang1997.github.io/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://lijianqiang1997.github.io/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://lijianqiang1997.github.io/"><h1>学习笔记</h1></a>
      <p class="lead">
          
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://lijianqiang1997.github.io/">Home</a> </li>
        
      </ul>
    </nav>

    <p>&copy; 2019. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>点击子元素跳转回退不丢失数据</h1>
  <time datetime=2019-11-22T14:30:11&#43;0800 class="post-date">Fri, Nov 22, 2019</time>
  <pre><code class="language-js">store.js;

import Vue from &quot;vue&quot;;
import Vuex from &quot;vuex&quot;;
Vue.use(Vuex);

const store = new Vuex.Store({
  state: {
    routeHistory: []
  }
});
export default store;
</code></pre>

<pre><code class="language-js">router.js;

import Router from 'vue-router'

var routerInstance = new Router()

//开启routeHistory总线
routerInstance.beforeEach((to,form,next)=&gt;{
    store.state.routeHistory.push(to.fullPath);
    next();
});

export default RouterInstance;
</code></pre>

<pre><code class="language-js">routeHistoryUtil.js

import stroe from './store.js'

export default {
    get: function(num=0) {
        num = Math.floor(num) || 0;
        const routeHistory = store.state.routeHistory;
        let length = routeHistory.length;
        if(length===0) {
            return void(0);
        }
        num = (num+length) % length;
        return routeHistory[num];
    }，
    getLast:function() {
        return this.get(-1);
    }
}
</code></pre>

<pre><code class="language-vue">app.vue

&lt;template&gt;
  &lt;div id=&quot;app&quot;&gt;
    // 是否使用keep-alive渲染
    &lt;keep-alive&gt;
      &lt;router-view v-if=&quot;$route.meta.keepAlive&quot; /&gt;
    &lt;/keep-alive&gt;
    &lt;router-view v-if=&quot;!$route.meta.keepAlive&quot; /&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>

<pre><code>demo.vue

&lt;template&gt;
    &lt;div class=&quot;demo&quot;&gt;&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
const defaultData = {

};
    export default {
        data() {
            return {
                ...defaultData
            }
        }
        activated() {
            const routeHistory = this.$store.state.routeHistory;
            let totalFlag = true;
            let fromPath,PfromPath,flag;
            if(!routeHistory.lenght&lt;3) {
                //最后一条记录是自身
                // 获取最后第二条记录
                fromPath = routeHistory[routeHistory.length-2];
                 // 获取最后第三条记录
                PfromPath = routeHistory[routeHistory.length-3];
                // 判断上一条路径是否是我们期望的
                flag = this.checkPath(fromPath);
                // 判断上上条记录是否是自身
                totalFlag = !flag || PfromPath !== this.$route.path;
            }
            // 如果上一条路径不在期望中或者上上条路径不是自身的话，重置初始数据
            if (totalFlag) {
                for (var attr in data) {
                    if (data.hasOwnProperty(attr)) {
                    this[attr] = data[attr];
                    }
                }
            }
            this.getData();
        }
    }
&lt;/script&gt;
</code></pre>

</div>


    </main>

    
  </body>
</html>
